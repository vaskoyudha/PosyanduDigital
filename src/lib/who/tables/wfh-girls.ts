/**
 * WHO Weight-for-Height (WFH) LMS values â€” Girls, 45.0-120.0 cm.
 *
 * Source: WHO Child Growth Standards (2006)
 * https://www.who.int/tools/child-growth-standards/standards/weight-for-length-height
 */
import type { WfhLMSRow } from '@/types/who'

/**
 * WFH Girls anchor points: [height_cm, L, M, S]
 */
export const WFH_GIRLS_ANCHORS: readonly [number, number, number, number][] = [
  [45.0, -0.3833, 2.461, 0.09029],
  [46.0, -0.3833, 2.541, 0.09005],
  [47.0, -0.3833, 2.625, 0.08980],
  [48.0, -0.3833, 2.715, 0.08952],
  [49.0, -0.3833, 2.812, 0.08923],
  [50.0, -0.3833, 2.917, 0.08892],
  [51.0, -0.3833, 3.030, 0.08859],
  [52.0, -0.3833, 3.149, 0.08824],
  [53.0, -0.3833, 3.272, 0.08790],
  [54.0, -0.3833, 3.399, 0.08759],
  [55.0, -0.3833, 3.530, 0.08731],
  [56.0, -0.3833, 3.664, 0.08709],
  [57.0, -0.3833, 3.802, 0.08694],
  [58.0, -0.3833, 3.943, 0.08686],
  [59.0, -0.3833, 4.087, 0.08686],
  [60.0, -0.3833, 4.232, 0.08694],
  [61.0, -0.3833, 4.377, 0.08710],
  [62.0, -0.3833, 4.522, 0.08734],
  [63.0, -0.3833, 4.665, 0.08764],
  [64.0, -0.3833, 4.807, 0.08802],
  [65.0, -0.3833, 4.948, 0.08846],
  [66.0, -0.3833, 5.087, 0.08895],
  [67.0, -0.3833, 5.226, 0.08950],
  [68.0, -0.3833, 5.365, 0.09010],
  [69.0, -0.3833, 5.505, 0.09075],
  [70.0, -0.3833, 5.647, 0.09144],
  [71.0, -0.3833, 5.791, 0.09218],
  [72.0, -0.3833, 5.940, 0.09295],
  [73.0, -0.3833, 6.093, 0.09376],
  [74.0, -0.3833, 6.250, 0.09459],
  [75.0, -0.3833, 6.411, 0.09546],
  [76.0, -0.3833, 6.576, 0.09635],
  [77.0, -0.3833, 6.744, 0.09726],
  [78.0, -0.3833, 6.916, 0.09819],
  [79.0, -0.3833, 7.090, 0.09913],
  [80.0, -0.3833, 7.267, 0.10008],
  [81.0, -0.3833, 7.446, 0.10103],
  [82.0, -0.3833, 7.627, 0.10199],
  [83.0, -0.3833, 7.810, 0.10294],
  [84.0, -0.3833, 7.993, 0.10388],
  [85.0, -0.3833, 8.178, 0.10482],
  [86.0, -0.3833, 8.364, 0.10576],
  [87.0, -0.3833, 8.551, 0.10669],
  [88.0, -0.3833, 8.740, 0.10762],
  [89.0, -0.3833, 8.929, 0.10854],
  [90.0, -0.3833, 9.119, 0.10946],
  [91.0, -0.3833, 9.310, 0.11037],
  [92.0, -0.3833, 9.502, 0.11128],
  [93.0, -0.3833, 9.695, 0.11219],
  [94.0, -0.3833, 9.890, 0.11310],
  [95.0, -0.3833, 10.088, 0.11401],
  [96.0, -0.3833, 10.289, 0.11492],
  [97.0, -0.3833, 10.494, 0.11583],
  [98.0, -0.3833, 10.703, 0.11674],
  [99.0, -0.3833, 10.917, 0.11765],
  [100.0, -0.3833, 11.136, 0.11856],
  [101.0, -0.3833, 11.360, 0.11948],
  [102.0, -0.3833, 11.590, 0.12039],
  [103.0, -0.3833, 11.826, 0.12130],
  [104.0, -0.3833, 12.068, 0.12220],
  [105.0, -0.3833, 12.317, 0.12310],
  [106.0, -0.3833, 12.573, 0.12401],
  [107.0, -0.3833, 12.836, 0.12492],
  [108.0, -0.3833, 13.107, 0.12584],
  [109.0, -0.3833, 13.386, 0.12678],
  [110.0, -0.3833, 13.674, 0.12773],
  [111.0, -0.3833, 13.970, 0.12870],
  [112.0, -0.3833, 14.275, 0.12968],
  [113.0, -0.3833, 14.588, 0.13067],
  [114.0, -0.3833, 14.910, 0.13167],
  [115.0, -0.3833, 15.241, 0.13267],
  [116.0, -0.3833, 15.581, 0.13366],
  [117.0, -0.3833, 15.930, 0.13464],
  [118.0, -0.3833, 16.288, 0.13560],
  [119.0, -0.3833, 16.655, 0.13654],
  [120.0, -0.3833, 17.030, 0.13744],
] as const

let _cached: readonly WfhLMSRow[] | null = null

export function getWfhGirls(): readonly WfhLMSRow[] {
  if (_cached) return _cached
  _cached = interpolateWfh(WFH_GIRLS_ANCHORS)
  return _cached
}

function interpolateWfh(
  anchors: readonly (readonly [number, number, number, number])[]
): WfhLMSRow[] {
  const result: WfhLMSRow[] = []
  const minH = anchors[0][0]
  const maxH = anchors[anchors.length - 1][0]

  for (let h10 = Math.round(minH * 10); h10 <= Math.round(maxH * 10); h10++) {
    const height = h10 / 10
    let lowerIdx = 0
    for (let i = 0; i < anchors.length - 1; i++) {
      if (anchors[i][0] <= height) lowerIdx = i
    }
    if (lowerIdx >= anchors.length - 1) lowerIdx = anchors.length - 2

    const [h0, L0, M0, S0] = anchors[lowerIdx]
    const [h1, L1, M1, S1] = anchors[lowerIdx + 1]
    const frac = (height - h0) / (h1 - h0)

    result.push({
      height: Math.round(height * 10) / 10,
      L: L0 + (L1 - L0) * frac,
      M: M0 + (M1 - M0) * frac,
      S: S0 + (S1 - S0) * frac,
    })
  }

  return result
}
