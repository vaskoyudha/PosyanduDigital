/**
 * WHO Weight-for-Age (WFA) LMS values â€” Girls, 0-60 months.
 *
 * Source: WHO Child Growth Standards (2006)
 * https://www.who.int/tools/child-growth-standards/standards/weight-for-age
 */
import type { LMSRow } from '@/types/who'

/** Monthly LMS anchor points: [month, L, M, S] */
export const WFA_GIRLS_MONTHLY: readonly [number, number, number, number][] = [
  [0,  -0.3833, 3.2322, 0.14171],
  [1,  -0.3833, 4.1873, 0.13724],
  [2,  -0.3833, 5.1282, 0.12888],
  [3,  -0.3833, 5.8458, 0.12348],
  [4,  -0.3833, 6.4237, 0.11945],
  [5,  -0.3833, 6.8985, 0.11576],
  [6,  -0.3833, 7.2970, 0.11290],
  [7,  -0.3833, 7.6422, 0.11010],
  [8,  -0.3833, 7.9487, 0.10774],
  [9,  -0.3833, 8.2254, 0.10579],
  [10, -0.3833, 8.4800, 0.10411],
  [11, -0.3833, 8.7192, 0.10271],
  [12, -0.3833, 8.9481, 0.10157],
  [13, -0.3833, 9.1699, 0.10065],
  [14, -0.3833, 9.3870, 0.09992],
  [15, -0.3833, 9.6008, 0.09936],
  [16, -0.3833, 9.8124, 0.09896],
  [17, -0.3833, 10.0226, 0.09869],
  [18, -0.3833, 10.2315, 0.09854],
  [19, -0.3833, 10.4393, 0.09850],
  [20, -0.3833, 10.6464, 0.09856],
  [21, -0.3833, 10.8534, 0.09871],
  [22, -0.3833, 11.0608, 0.09895],
  [23, -0.3833, 11.2688, 0.09927],
  [24, -0.3833, 11.4775, 0.09966],
  [25, -0.3833, 11.6864, 0.10014],
  [26, -0.3833, 11.8947, 0.10069],
  [27, -0.3833, 12.1020, 0.10130],
  [28, -0.3833, 12.3077, 0.10195],
  [29, -0.3833, 12.5111, 0.10265],
  [30, -0.3833, 12.7118, 0.10339],
  [31, -0.3833, 12.9096, 0.10416],
  [32, -0.3833, 13.1041, 0.10497],
  [33, -0.3833, 13.2952, 0.10580],
  [34, -0.3833, 13.4830, 0.10664],
  [35, -0.3833, 13.6677, 0.10750],
  [36, -0.3833, 13.8497, 0.10838],
  [37, -0.3833, 14.0290, 0.10928],
  [38, -0.3833, 14.2062, 0.11020],
  [39, -0.3833, 14.3816, 0.11112],
  [40, -0.3833, 14.5555, 0.11206],
  [41, -0.3833, 14.7282, 0.11301],
  [42, -0.3833, 14.9001, 0.11397],
  [43, -0.3833, 15.0715, 0.11494],
  [44, -0.3833, 15.2425, 0.11591],
  [45, -0.3833, 15.4134, 0.11688],
  [46, -0.3833, 15.5844, 0.11784],
  [47, -0.3833, 15.7558, 0.11880],
  [48, -0.3833, 15.9278, 0.11975],
  [49, -0.3833, 16.1006, 0.12068],
  [50, -0.3833, 16.2743, 0.12159],
  [51, -0.3833, 16.4492, 0.12249],
  [52, -0.3833, 16.6254, 0.12337],
  [53, -0.3833, 16.8031, 0.12423],
  [54, -0.3833, 16.9824, 0.12507],
  [55, -0.3833, 17.1635, 0.12589],
  [56, -0.3833, 17.3463, 0.12668],
  [57, -0.3833, 17.5310, 0.12745],
  [58, -0.3833, 17.7175, 0.12820],
  [59, -0.3833, 17.9060, 0.12892],
  [60, -0.3833, 18.0967, 0.12961],
] as const

let _cachedDaily: readonly LMSRow[] | null = null

export function getWfaGirls(): readonly LMSRow[] {
  if (_cachedDaily) return _cachedDaily
  _cachedDaily = interpolateDaily(WFA_GIRLS_MONTHLY)
  return _cachedDaily
}

function interpolateDaily(
  monthly: readonly (readonly [number, number, number, number])[]
): LMSRow[] {
  const DAYS_PER_MONTH = 30.4375
  const maxDay = 1856
  const result: LMSRow[] = []

  for (let day = 0; day <= maxDay; day++) {
    const monthExact = day / DAYS_PER_MONTH
    let lowerIdx = Math.floor(monthExact)
    if (lowerIdx >= monthly.length - 1) lowerIdx = monthly.length - 2
    if (lowerIdx < 0) lowerIdx = 0
    const upperIdx = lowerIdx + 1

    const [, L0, M0, S0] = monthly[lowerIdx]
    const [, L1, M1, S1] = monthly[upperIdx]
    const frac = monthExact - lowerIdx

    result.push({
      day,
      L: L0 + (L1 - L0) * frac,
      M: M0 + (M1 - M0) * frac,
      S: S0 + (S1 - S0) * frac,
    })
  }

  return result
}
